---
title: "Data Developer Salary Analysis"
author: "By Ian Joshua Sainani"
date: 25 Jul 2024
output:
  pdf_document: default
  html_notebook: default
  html_document:
    df_print: paged
---
### Data Source: https://www.kaggle.com/datasets/zeesolver/data-eng-salary-2024
```{r global.options, include = TRUE, echo=FALSE}
# Set global and markdown global options
knitr::opts_chunk$set(
    cache       = TRUE,     # if TRUE knitr will cache the results to reuse in future knits
    fig.width   = 5,       # the width for plots created by code chunk
    fig.height  = 5,       # the height for plots created by code chunk
    fig.align   = 'center', # how to align graphics in the final doc. 'left', 'right', 'center'
    fig.path    = 'figs/',  # file path to the directory where knitr shall store the graphics files
    #results     = 'asis',   # knitr will pass through results without reformatting them
    echo        = TRUE,     # in FALSE knitr will not display code in the code chunk above it's results
    message     = TRUE,     # if FALSE knitr will not display any messages generated by code
    strip.white = TRUE,     # if FALSE knitr will not remove white spaces at the beg or end of code chunk
    warning     = FALSE)    # if FALSE knitr will not display any warning messages in the final document


```


# Load Packages
```{r load-packages, message = FALSE}
library(dplyr)
library(ggplot2)
library(statsr)
library("scales")
library(countrycode)
```

# Import Data

```{r}
salaries_df <- read.csv("~/Library/CloudStorage/OneDrive-NanyangTechnologicalUniversity/personal projects/R Projects/Data Developer Salary 2024/salaries_data.csv")
```

# Data Exploration
### Overview of the structure of salaries_df

```{r}
str(salaries_df)
```

### Check for missing data

```{r}
cat("Count of null values:", sum(is.na(salaries_df)))
```

### View unique values in columns of interest

```{r}
distinct_values <- list(
  Years = unique(salaries_df$work_year),
  Experience_Levels = unique(salaries_df$experience_level),
  Employment_Types = unique(salaries_df$employment_type),
  Company_Sizes = unique(salaries_df$company_size),
  Company_Location = unique(salaries_df$company_location)
)

distinct_values
```

# Problem Formulation
### Average Salary of each Job Title

```{r}
average_salaries <- salaries_df %>%
  filter(employment_type == "FT") %>%
  group_by(job_title) %>%
  summarise(AvgSalary = mean(salary_in_usd), MedSalary = median(salary_in_usd), 
            MinSalary = min(salary_in_usd), MaxSalary = max(salary_in_usd),
            Std = sd(salary_in_usd)) %>%
  arrange(desc(AvgSalary))

average_salaries
```
```{r}
# Standard deviation of salaries among all individual full time jobs
std_all <- salaries_df %>%
  filter(employment_type == "FT") %>%
  summarise(std = sd(salary_in_usd))

# Standard deviation of average salaries, among full time, unique job titles
std_unique <- average_salaries %>%
  summarise(std = sd(average_salaries$AvgSalary))

cat("Standard deviation (FT, All):", std_all$std, '\n')
cat("Standard deviation (FT, Unique):", std_unique$std)
```

### The standard deviations can be observed to be very large, and it can be seen to drop as we establish a grouping. 
### We want to then find out if there are any factors that impact the salaries of employees, and in what way.

# How does experience level affect salary?
### For a fair comparison, we will filter only FT employees

```{r}
# Descriptive Statistics
exp_salaries <- salaries_df %>%
  filter(employment_type == "FT") %>%
  group_by(experience_level) %>%
  summarise(min = min(salary_in_usd), q1 = quantile(salary_in_usd,0.25), 
    AvgExpSalary = mean(salary_in_usd), median = median(salary_in_usd), 
    q3 = quantile(salary_in_usd, 0.75), max = max(salary_in_usd),
    std = sd(salary_in_usd)) %>%
  arrange(desc(AvgExpSalary))

# Create a colour gradient
colour_gradient_exp <- c("EN" = "#b3cde3", "MI" = "#8c96c6", "SE" = "#8856a7", "EX" = "#810f7c")

# Sort experience level
exp_level <- c('EN', 'MI', 'SE', 'EX')

# Create a barplot
salary_vs_exp <- ggplot(data = exp_salaries, aes(x = factor(experience_level, 
                level = exp_level), y = AvgExpSalary, fill = experience_level)) +                                            geom_col(width = 0.4, show.legend = FALSE) + 
                scale_y_continuous(labels = comma) +
                scale_fill_manual(values = colour_gradient_exp)

# Styling
salary_vs_exp + labs(title = "Average Salary vs Experience Level", x = "Experience Level", 
                     y = "Average Salary (USD)") + 
                     theme(plot.title = element_text(hjust = 0.5),
                     panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                     panel.background = element_blank(), axis.line = element_line(colour = "black")) 
# View Descriptive Statistics
exp_salaries
```
```{r}
# Create a boxplot
bp_exp_salaries <- ggplot(data = salaries_df, aes(x = factor(experience_level, 
                  level = exp_level), y = salary_in_usd, 
                  fill = experience_level)) + geom_boxplot(show.legend = FALSE) + 
                  scale_y_continuous(labels = comma)+
                  scale_fill_manual(values = colour_gradient_exp)

# Styling
bp_exp_salaries + labs(title = "Salary Distribution among Experience Levels", 
                       x = "Experience Level", y = "Salary (USD)") + 
                      theme(plot.title = element_text(hjust = 0.5),
                      panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                      panel.background = element_blank(), axis.line = element_line(colour = "black")) 
```

# How does employment type affect salary?

```{r}
# Descriptive Statistics
emp_salaries <- salaries_df %>%
  group_by(employment_type) %>%
  summarise(min = min(salary_in_usd), q1 = quantile(salary_in_usd, 0.25), 
    AvgEmpSalary = mean(salary_in_usd), median = median(salary_in_usd), 
    q3 = quantile(salary_in_usd, 0.75), max = max(salary_in_usd),
    std = sd(salary_in_usd)) %>%
  arrange(desc(AvgEmpSalary))

# Create a colour gradient
colour_gradient_emp <- c("FL" = "#edf8d1", "PT" = "#bae4b3", "CT" = "#74c476", "FT" = "#238b45")

# Sort employment type
emp_type <- c('FL', 'PT', 'CT', 'FT')

# Create a barplot
salary_vs_emp <- ggplot(data = emp_salaries, aes(x = factor(employment_type, 
                 level = emp_type), y = AvgEmpSalary, fill = employment_type)) + 
                 geom_col(width = 0.4, show.legend = FALSE) + 
                 scale_y_continuous(labels = comma) + 
                 scale_fill_manual(values = colour_gradient_emp)

# Styling
salary_vs_emp + labs(title = "Average Salary vs Employment Type", x = "Employment Type", 
                     y = "Average Salary (USD)") + 
                      theme(plot.title = element_text(hjust = 0.5),
                      panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                      panel.background = element_blank(), axis.line = element_line(colour = "black")) 
# View Descriptive Statistics
emp_salaries
```
```{r}
# Create a boxplot
bp_emp_salaries <- ggplot(data = salaries_df, aes(x = factor(employment_type, 
                  level = emp_type), y = salary_in_usd, 
                  fill = employment_type)) + geom_boxplot(show.legend = FALSE) + 
                  scale_y_continuous(labels = comma)+
                  scale_fill_manual(values = colour_gradient_emp)

# Styling
bp_emp_salaries + labs(title = "Salary Distribution among Employment Types", 
                       x = "Employment Type", y = "Salary (USD)") + 
                      theme(plot.title = element_text(hjust = 0.5),
                      panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                      panel.background = element_blank(), axis.line = element_line(colour = "black")) 
```

# Does remote ratio have an impact on salary?

```{r}
cor.test(salaries_df$remote_ratio, salaries_df$salary_in_usd)
```

#### With a correlation score of -0.0573, there is a very weak negative correlation between the remote ratio and salary.

# How does company region affect salary?

```{r}
# Create new column indicating region of company location

salaries_df$company_region = countrycode(salaries_df$company_location, "iso2c","region")
```


```{r}
# Descriptive Statistics
reg_salaries <- salaries_df %>%
  filter(employment_type == "FT") %>%
  group_by(company_region) %>%
  summarise(min = min(salary_in_usd), q1 = quantile(salary_in_usd, 0.25), 
    AvgRegSalary = mean(salary_in_usd), median = median(salary_in_usd), 
    q3 = quantile(salary_in_usd, 0.75), max = max(salary_in_usd),
    std = sd(salary_in_usd)) %>%
  arrange(desc(AvgRegSalary))  

# Create a boxplot
bp_reg_salaries <- ggplot(data = salaries_df, aes(x = company_region, y = salary_in_usd, 
                   fill = company_region)) + 
                   geom_boxplot(show.legend = FALSE) + 
                   scale_y_continuous(labels = comma) +
                   theme(axis.text.x = element_text(angle = 10, hjust = 1, size = 7)) +
                   scale_fill_brewer(palette = "Set3")

# Styling
bp_reg_salaries + labs(title = "Salary Distribution among Regions", 
                       x = "Region", y = "Salary (USD)") + 
                      theme(plot.title = element_text(hjust = 0.5),
                      panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                      panel.background = element_blank(), axis.line = element_line(colour = "black"))   
# View Descriptive Statistics
reg_salaries
```

### Drill down into regional salary distribution for each experience level

```{r}
# Get the unique experience levels
experience_levels <- unique(salaries_df$experience_level)

# Loop through each experience level and create a boxplot
for (x in experience_levels) {
  # Subset data for the current experience level and employment type FT
  subset_df <- subset(salaries_df, experience_level == x & employment_type == "FT")
  
    # Create the boxplots
    plots <- ggplot(data = subset_df, aes(x = company_region, y = salary_in_usd, fill = company_region)) + 
      geom_boxplot(show.legend = FALSE) + 
      scale_y_continuous(labels = comma) +
      scale_fill_brewer(palette = "Set3") +
      labs(title = paste("Regional Salary Distribution for", x, "Employees"),
      x = "Company Region", y = "Salary (USD)") +
      theme(axis.text.x = element_text(angle = 10, hjust = 1, size = 7),
            panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            panel.background = element_blank(), axis.line = element_line(colour = "black"),                              plot.title = element_text(hjust = 0.5))

    print(plots)
}

```

# Does the size of the company impact the salary of their employees?

```{r}
# Descriptive Statistics
size_salaries <- salaries_df %>%
  filter(employment_type == "FT") %>%
  group_by(company_size) %>%
  summarise(min = min(salary_in_usd), q1 = quantile(salary_in_usd, 0.25), 
    AvgSizeSalary = mean(salary_in_usd), median = median(salary_in_usd), 
    q3 = quantile(salary_in_usd, 0.75), max = max(salary_in_usd),
    std = sd(salary_in_usd))
 
# Create a colour gradient
colour_gradient_size <- c("S" = "#ffbaba", "M" = "#ff7b7b", "L" = "#ff5252")

# Sort company size
size_level <- c('S', 'M', 'L')

# Create a barplot
salary_vs_size <- ggplot(data = size_salaries, aes(x = factor(company_size, level = size_level), 
                  y = AvgSizeSalary, fill = company_size)) +                               
                  geom_col(width = 0.4, show.legend = FALSE) + 
                  scale_y_continuous(labels = comma) +
                  scale_fill_manual(values = colour_gradient_size)

# Styling
salary_vs_size + labs(title = "Average Salary vs Company Size", x = "Company Size", 
                     y = "Average Salary (USD)") + 
                      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                      panel.background = element_blank(), axis.line = element_line(colour = "black"),                              plot.title = element_text(hjust = 0.5))
# View Descriptive Statistics
size_salaries
```
```{r}
# Create a boxplot
bp_size_salaries <- ggplot(data = salaries_df, aes(x = factor(company_size, 
                  level = size_level), y = salary_in_usd, 
                  fill = company_size)) + geom_boxplot(show.legend = FALSE) + 
                  scale_y_continuous(labels = comma)+
                  scale_fill_manual(values = colour_gradient_size)

# Styling
bp_size_salaries + labs(title = "Salary Distribution among Company Sizes", 
                       x = "Company Size", y = "Salary (USD)") + 
                      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                      panel.background = element_blank(), axis.line = element_line(colour = "black"),                              plot.title = element_text(hjust = 0.5))
```

# How has the average salary changed over the years?

```{r}
# Descriptive Statistics
years_salaries <- salaries_df %>%
  filter(employment_type == "FT") %>%
  group_by(work_year) %>%
  summarise(min = min(salary_in_usd), q1 = quantile(salary_in_usd, 0.25), 
    AvgYearSalary = mean(salary_in_usd), median = median(salary_in_usd), 
    q3 = quantile(salary_in_usd, 0.75), max = max(salary_in_usd),
    std = sd(salary_in_usd))

# Create a line plot
line_years_salaries <- ggplot(data = years_salaries, aes(x = work_year, y = AvgYearSalary)) + 
                       geom_line(color = "darkblue") + 
                       scale_y_continuous(labels = comma, limits = c(0,NA))

# Styling
line_years_salaries + labs(title = "Average Salary Trend", 
                       x = "Year", y = "Average Salary (USD)") + 
                      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                      panel.background = element_blank(), axis.line = element_line(colour = "black"),                              plot.title = element_text(hjust = 0.5))
# View Descriptive Statistics
years_salaries

```